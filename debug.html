<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Tarot App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .diagnostic-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }

        .diagnostic-section.success {
            border-left-color: #2ecc71;
        }

        .diagnostic-section.error {
            border-left-color: #e74c3c;
        }

        .diagnostic-section.warning {
            border-left-color: #f39c12;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-icon {
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .test-item:last-child {
            margin-bottom: 0;
        }

        .test-name {
            flex: 1;
            font-weight: 500;
        }

        .test-result {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .test-result.pass {
            background: #2ecc71;
            color: white;
        }

        .test-result.fail {
            background: #e74c3c;
            color: white;
        }

        .test-result.pending {
            background: #f39c12;
            color: white;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .details {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h1>
            <p>–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Tarot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
        </div>

        <div class="controls">
            <button class="btn" id="runFullDiagnostic">üöÄ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
            <button class="btn" id="checkSupabase">‚òÅÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase</button>
            <button class="btn" id="testDatabase">üóÑÔ∏è –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="btn" id="clearResults">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div id="diagnosticResults"></div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const SUPABASE_CONFIG = {
            url: 'https://jjowuzqrhwcuulcnkxh.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impqb3d1enFyaHdjdXVsY25reGgiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTczNzM4NzU1NywiZXhwIjoyMDUyOTYzNTU3fQ.2TXJ5qnz2vj0k3cGSrEYC8jfhgkKmj5P-e0hJdSb4-Q'
        };

        let supabaseClient = null;
        let testResults = {};

        // –£—Ç–∏–ª–∏—Ç—ã
        function updateProgress(percentage) {
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }

        function createSection(title, icon, status = 'info') {
            const section = document.createElement('div');
            section.className = `diagnostic-section ${status}`;
            section.innerHTML = `
                <div class="section-title">
                    <span class="section-icon">${icon}</span>
                    ${title}
                </div>
                <div class="section-content"></div>
                <div class="timestamp">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${new Date().toLocaleString()}</div>
            `;
            return section;
        }

        function addTestItem(container, testName, result, details = '') {
            const statusClass = result === 'pass' ? 'pass' : result === 'fail' ? 'fail' : 'pending';
            const statusText = result === 'pass' ? '–ü–†–û–ô–î–ï–ù' : result === 'fail' ? '–û–®–ò–ë–ö–ê' : '–û–ñ–ò–î–ê–ù–ò–ï';
            
            const testItem = document.createElement('div');
            testItem.className = 'test-item';
            testItem.innerHTML = `
                <div class="test-name">${testName}</div>
                <div class="test-result ${statusClass}">${statusText}</div>
            `;
            
            if (details) {
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'details';
                detailsDiv.textContent = details;
                testItem.appendChild(detailsDiv);
            }
            
            container.appendChild(testItem);
        }

        // –¢–µ—Å—Ç—ã

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        async function testBrowserEnvironment() {
            const section = createSection('–û–∫—Ä—É–∂–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞', 'üåê', 'info');
            const content = section.querySelector('.section-content');
            
            const tests = [
                {
                    name: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ ES6+',
                    test: () => {
                        try {
                            eval('const test = () => Promise.resolve();');
                            return { pass: true };
                        } catch (e) {
                            return { pass: false, details: e.message };
                        }
                    }
                },
                {
                    name: 'Fetch API',
                    test: () => ({
                        pass: typeof fetch !== 'undefined',
                        details: typeof fetch !== 'undefined' ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'
                    })
                },
                {
                    name: 'LocalStorage',
                    test: () => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return { pass: true, details: '–î–æ—Å—Ç—É–ø–µ–Ω' };
                        } catch (e) {
                            return { pass: false, details: e.message };
                        }
                    }
                },
                {
                    name: 'HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ',
                    test: () => ({
                        pass: location.protocol === 'https:' || location.hostname === 'localhost',
                        details: `–ü—Ä–æ—Ç–æ–∫–æ–ª: ${location.protocol}`
                    })
                }
            ];

            let passCount = 0;
            for (const test of tests) {
                const result = test.test();
                addTestItem(content, test.name, result.pass ? 'pass' : 'fail', result.details);
                if (result.pass) passCount++;
            }

            section.className = `diagnostic-section ${passCount === tests.length ? 'success' : 'warning'}`;
            return { section, passed: passCount, total: tests.length };
        }

        // 2. –ó–∞–≥—Ä—É–∑–∫–∞ Supabase
        async function testSupabaseLoading() {
            const section = createSection('–ó–∞–≥—Ä—É–∑–∫–∞ Supabase SDK', 'üì¶', 'info');
            const content = section.querySelector('.section-content');

            try {
                addTestItem(content, '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Supabase', window.supabase ? 'pass' : 'fail', 
                    window.supabase ? '–£–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω' : '–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞');

                if (!window.supabase) {
                    addTestItem(content, '–ó–∞–≥—Ä—É–∑–∫–∞ Supabase SDK', 'pending', '–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
                    
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                    
                    content.removeChild(content.lastChild);
                    addTestItem(content, '–ó–∞–≥—Ä—É–∑–∫–∞ Supabase SDK', 'pass', '–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }

                const tests = [
                    {
                        name: 'Supabase –æ–±—ä–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω',
                        result: window.supabase ? 'pass' : 'fail',
                        details: window.supabase ? '–û–±—ä–µ–∫—Ç –Ω–∞–π–¥–µ–Ω' : '–û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'
                    },
                    {
                        name: '–ú–µ—Ç–æ–¥ createClient',
                        result: window.supabase?.createClient ? 'pass' : 'fail',
                        details: window.supabase?.createClient ? '–ú–µ—Ç–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω' : '–ú–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω'
                    }
                ];

                let passCount = 0;
                tests.forEach(test => {
                    addTestItem(content, test.name, test.result, test.details);
                    if (test.result === 'pass') passCount++;
                });

                section.className = `diagnostic-section ${passCount === tests.length ? 'success' : 'error'}`;
                return { section, passed: passCount, total: tests.length };

            } catch (error) {
                addTestItem(content, '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞', 'fail', error.message);
                section.className = 'diagnostic-section error';
                return { section, passed: 0, total: 1 };
            }
        }

        // 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
        async function testSupabaseConnection() {
            const section = createSection('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase', 'üîó', 'info');
            const content = section.querySelector('.section-content');

            try {
                addTestItem(content, '–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ Supabase', 'pending', '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
                
                supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                
                content.removeChild(content.lastChild);
                addTestItem(content, '–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ Supabase', 'pass', '–ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω');

                addTestItem(content, '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'pending', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...');
                
                const { data, error } = await supabaseClient.from('profiles').select('count').limit(1);
                
                content.removeChild(content.lastChild);
                
                if (error && error.code !== 'PGRST116') {
                    addTestItem(content, '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'fail', `–û—à–∏–±–∫–∞: ${error.message}`);
                    section.className = 'diagnostic-section error';
                    return { section, passed: 1, total: 2 };
                } else {
                    addTestItem(content, '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'pass', '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
                    const additionalTests = [
                        {
                            name: '–í–∞–ª–∏–¥–∞—Ü–∏—è URL',
                            result: SUPABASE_CONFIG.url.startsWith('https://') ? 'pass' : 'fail',
                            details: `URL: ${SUPABASE_CONFIG.url}`
                        },
                        {
                            name: '–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–∞',
                            result: SUPABASE_CONFIG.key.length > 100 ? 'pass' : 'fail',
                            details: `–î–ª–∏–Ω–∞ –∫–ª—é—á–∞: ${SUPABASE_CONFIG.key.length} —Å–∏–º–≤–æ–ª–æ–≤`
                        }
                    ];

                    let passCount = 2; // –£–∂–µ 2 –ø—Ä–æ—à–ª–∏
                    additionalTests.forEach(test => {
                        addTestItem(content, test.name, test.result, test.details);
                        if (test.result === 'pass') passCount++;
                    });

                    section.className = `diagnostic-section ${passCount === 4 ? 'success' : 'warning'}`;
                    return { section, passed: passCount, total: 4 };
                }

            } catch (error) {
                addTestItem(content, '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞', 'fail', error.message);
                section.className = 'diagnostic-section error';
                return { section, passed: 0, total: 1 };
            }
        }

        // 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function testDatabaseOperations() {
            const section = createSection('–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö', 'üóÑÔ∏è', 'info');
            const content = section.querySelector('.section-content');

            if (!supabaseClient) {
                addTestItem(content, '–ö–ª–∏–µ–Ω—Ç Supabase', 'fail', '–ö–ª–∏–µ–Ω—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                section.className = 'diagnostic-section error';
                return { section, passed: 0, total: 1 };
            }

            const tests = [
                {
                    name: '–ß—Ç–µ–Ω–∏–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã profiles',
                    test: async () => {
                        const { data, error } = await supabaseClient
                            .from('profiles')
                            .select('*')
                            .limit(5);
                        
                        if (error && error.code !== 'PGRST116') {
                            return { pass: false, details: error.message };
                        }
                        return { pass: true, details: `–ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${data?.length || 0}` };
                    }
                },
                {
                    name: '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è',
                    test: async () => {
                        const testProfile = {
                            id: `diagnostic_test_${Date.now()}`,
                            premium: false,
                            created_at: new Date().toISOString()
                        };

                        const { data, error } = await supabaseClient
                            .from('profiles')
                            .insert([testProfile])
                            .select();

                        if (error) {
                            return { pass: false, details: error.message };
                        }
                        return { pass: true, details: `–°–æ–∑–¥–∞–Ω –ø—Ä–æ—Ñ–∏–ª—å: ${data[0]?.id}` };
                    }
                },
                {
                    name: '–£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è',
                    test: async () => {
                        const { data, error } = await supabaseClient
                            .from('profiles')
                            .delete()
                            .like('id', 'diagnostic_test_%');

                        if (error) {
                            return { pass: false, details: error.message };
                        }
                        return { pass: true, details: '–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã' };
                    }
                }
            ];

            let passCount = 0;
            for (const test of tests) {
                addTestItem(content, test.name, 'pending', '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...');
                
                try {
                    const result = await test.test();
                    content.removeChild(content.lastChild);
                    addTestItem(content, test.name, result.pass ? 'pass' : 'fail', result.details);
                    if (result.pass) passCount++;
                } catch (error) {
                    content.removeChild(content.lastChild);
                    addTestItem(content, test.name, 'fail', error.message);
                }
            }

            section.className = `diagnostic-section ${passCount === tests.length ? 'success' : passCount > 0 ? 'warning' : 'error'}`;
            return { section, passed: passCount, total: tests.length };
        }

        // 5. –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        async function testPerformance() {
            const section = createSection('–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', '‚ö°', 'info');
            const content = section.querySelector('.section-content');

            if (!supabaseClient) {
                addTestItem(content, '–ö–ª–∏–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'fail', '–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase');
                section.className = 'diagnostic-section error';
                return { section, passed: 0, total: 1 };
            }

            const tests = [
                {
                    name: '–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ (SELECT)',
                    test: async () => {
                        const start = performance.now();
                        const { data, error } = await supabaseClient
                            .from('profiles')
                            .select('*')
                            .limit(10);
                        const end = performance.now();
                        
                        const duration = Math.round(end - start);
                        return {
                            pass: duration < 2000 && !error,
                            details: error ? error.message : `–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${duration}–º—Å`
                        };
                    }
                },
                {
                    name: '–°–∫–æ—Ä–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏',
                    test: async () => {
                        const start = performance.now();
                        const { data, error } = await supabaseClient
                            .from('profiles')
                            .insert([{
                                id: `perf_test_${Date.now()}`,
                                premium: false
                            }])
                            .select();
                        const end = performance.now();
                        
                        // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å
                        if (data?.[0]) {
                            await supabaseClient
                                .from('profiles')
                                .delete()
                                .eq('id', data[0].id);
                        }
                        
                        const duration = Math.round(end - start);
                        return {
                            pass: duration < 3000 && !error,
                            details: error ? error.message : `–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${duration}–º—Å`
                        };
                    }
                }
            ];

            let passCount = 0;
            for (const test of tests) {
                addTestItem(content, test.name, 'pending', '–ò–∑–º–µ—Ä–µ–Ω–∏–µ...');
                
                try {
                    const result = await test.test();
                    content.removeChild(content.lastChild);
                    addTestItem(content, test.name, result.pass ? 'pass' : 'fail', result.details);
                    if (result.pass) passCount++;
                } catch (error) {
                    content.removeChild(content.lastChild);
                    addTestItem(content, test.name, 'fail', error.message);
                }
            }

            section.className = `diagnostic-section ${passCount === tests.length ? 'success' : 'warning'}`;
            return { section, passed: passCount, total: tests.length };
        }

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        async function runFullDiagnostic() {
            const resultsContainer = document.getElementById('diagnosticResults');
            resultsContainer.innerHTML = '';
            updateProgress(0);

            const diagnostics = [
                { name: 'browser', func: testBrowserEnvironment, weight: 10 },
                { name: 'supabase-loading', func: testSupabaseLoading, weight: 20 },
                { name: 'supabase-connection', func: testSupabaseConnection, weight: 30 },
                { name: 'database', func: testDatabaseOperations, weight: 25 },
                { name: 'performance', func: testPerformance, weight: 15 }
            ];

            let totalProgress = 0;
            let totalPassed = 0;
            let totalTests = 0;

            for (const diagnostic of diagnostics) {
                const result = await diagnostic.func();
                resultsContainer.appendChild(result.section);
                
                totalPassed += result.passed;
                totalTests += result.total;
                totalProgress += diagnostic.weight;
                updateProgress(totalProgress);
                
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ UX
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            // –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
            const summarySection = createSection(
                `–ò—Ç–æ–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (${totalPassed}/${totalTests})`,
                'üìä',
                totalPassed === totalTests ? 'success' : totalPassed > totalTests * 0.7 ? 'warning' : 'error'
            );
            
            const summaryContent = summarySection.querySelector('.section-content');
            const percentage = Math.round((totalPassed / totalTests) * 100);
            
            summaryContent.innerHTML = `
                <div class="details">
                –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ${percentage}%
                –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${totalPassed}
                –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${totalTests}
                –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: ${percentage >= 90 ? '–û—Ç–ª–∏—á–Ω–æ' : percentage >= 70 ? '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ' : '–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è'}
                </div>
            `;
            
            resultsContainer.appendChild(summarySection);
            updateProgress(100);
        }

        async function quickSupabaseCheck() {
            const resultsContainer = document.getElementById('diagnosticResults');
            resultsContainer.innerHTML = '';
            updateProgress(0);

            updateProgress(33);
            const loadingResult = await testSupabaseLoading();
            resultsContainer.appendChild(loadingResult.section);

            updateProgress(66);
            const connectionResult = await testSupabaseConnection();
            resultsContainer.appendChild(connectionResult.section);

            updateProgress(100);
        }

        async function quickDatabaseCheck() {
            const resultsContainer = document.getElementById('diagnosticResults');
            resultsContainer.innerHTML = '';
            updateProgress(0);

            if (!supabaseClient) {
                updateProgress(50);
                await testSupabaseConnection();
            }

            updateProgress(75);
            const dbResult = await testDatabaseOperations();
            resultsContainer.appendChild(dbResult.section);

            updateProgress(100);
        }

        function clearResults() {
            document.getElementById('diagnosticResults').innerHTML = '';
            updateProgress(0);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('runFullDiagnostic').addEventListener('click', runFullDiagnostic);
            document.getElementById('checkSupabase').addEventListener('click', quickSupabaseCheck);
            document.getElementById('testDatabase').addEventListener('click', quickDatabaseCheck);
            document.getElementById('clearResults').addEventListener('click', clearResults);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
            setTimeout(() => {
                testBrowserEnvironment().then(result => {
                    document.getElementById('diagnosticResults').appendChild(result.section);
                });
            }, 500);
        });
    </script>
</body>
</html>
