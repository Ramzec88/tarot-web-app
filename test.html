<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ—Ç–µ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Supabase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .alert {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .alert-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ff6b6b;
        }

        .diagnostic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .diagnostic-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            border-left: 4px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .diagnostic-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .diagnostic-card.error {
            border-left-color: #ff6b6b;
        }

        .diagnostic-card.success {
            border-left-color: #51cf66;
        }

        .diagnostic-card.warning {
            border-left-color: #ffd43b;
        }

        .card-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .card-icon {
            margin-right: 10px;
            font-size: 1.4rem;
        }

        .card-content {
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.success { background: #51cf66; }
        .status-indicator.error { background: #ff6b6b; }
        .status-indicator.warning { background: #ffd43b; }
        .status-indicator.pending { 
            background: #868e96; 
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            margin: 10px 0;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .solution-section {
            background: rgba(81, 207, 102, 0.1);
            border: 2px solid #51cf66;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .solution-title {
            font-size: 1.4rem;
            color: #51cf66;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #51cf66);
            width: 0%;
            transition: width 0.5s ease;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .log-entry {
            padding: 3px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-timestamp {
            color: #868e96;
            margin-right: 10px;
        }

        .log-success { color: #51cf66; }
        .log-error { color: #ff6b6b; }
        .log-warning { color: #ffd43b; }
        .log-info { color: #74c0fc; }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            .diagnostic-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: center; }
            .btn { width: 100%; max-width: 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h1>
            <p>–ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Supabase</p>
        </div>

        <div class="alert">
            <div class="alert-title">‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å–µ—Ç–∏</div>
            <p>–û—à–∏–±–∫–∞ "TypeError: Load failed" —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase. –ó–∞–ø—É—Å—Ç–∏–º –¥–µ—Ç–∞–ª—å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.</p>
        </div>

        <div class="controls">
            <button class="btn" id="startDiagnostic">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
            <button class="btn" id="testAlternativeConnection">üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            <button class="btn" id="fixConfiguration">‚öôÔ∏è –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            <button class="btn danger" id="clearLogs">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="diagnostic-grid" id="diagnosticGrid"></div>

        <div class="log-container" id="logContainer"></div>

        <div class="solution-section" id="solutionSection" style="display: none;">
            <div class="solution-title">
                <span style="margin-right: 10px;">‚úÖ</span>
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—à–µ–Ω–∏—è
            </div>
            <div id="solutionContent"></div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const SUPABASE_CONFIG = {
            url: 'https://jjowuzqrhwcuulcnkxh.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impqb3d1enFyaHdjdXVsY25reGgiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTczNzM4NzU1NywiZXhwIjoyMDUyOTYzNTU3fQ.2TXJ5qnz2vj0k3cGSrEYC8jfhgkKmj5P-e0hJdSb4-Q'
        };

        // –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        const logger = {
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span class="log-${type}">${message}</span>
                `;
                document.getElementById('logContainer').appendChild(logEntry);
                document.getElementById('logContainer').scrollTop = document.getElementById('logContainer').scrollHeight;
                console.log(`[${timestamp}] ${message}`);
            },
            
            success(message) { this.log(`‚úÖ ${message}`, 'success'); },
            error(message) { this.log(`‚ùå ${message}`, 'error'); },
            warning(message) { this.log(`‚ö†Ô∏è ${message}`, 'warning'); },
            info(message) { this.log(`‚ÑπÔ∏è ${message}`, 'info'); }
        };

        // –£—Ç–∏–ª–∏—Ç—ã
        function updateProgress(percentage) {
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }

        function createDiagnosticCard(title, icon, status = 'pending') {
            const card = document.createElement('div');
            card.className = `diagnostic-card ${status}`;
            card.innerHTML = `
                <div class="card-title">
                    <span class="card-icon">${icon}</span>
                    <span class="status-indicator ${status}"></span>
                    ${title}
                </div>
                <div class="card-content" id="${title.toLowerCase().replace(/\s+/g, '-')}-content">
                    –ü—Ä–æ–≤–µ—Ä–∫–∞...
                </div>
            `;
            return card;
        }

        function updateCard(cardId, content, status) {
            const card = document.getElementById(`${cardId}-content`);
            if (card) {
                card.textContent = content;
                const parentCard = card.closest('.diagnostic-card');
                parentCard.className = `diagnostic-card ${status}`;
                const indicator = parentCard.querySelector('.status-indicator');
                indicator.className = `status-indicator ${status}`;
            }
        }

        // –¢–µ—Å—Ç—ã —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

        // 1. –ë–∞–∑–æ–≤–∞—è —Å–µ—Ç–µ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
        async function testNetworkConnectivity() {
            const cardId = '—Å–µ—Ç–µ–≤–∞—è-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å';
            logger.info('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏...');

            try {
                // –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
                const internetTest = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    mode: 'cors',
                    timeout: 5000
                });

                if (internetTest.ok) {
                    updateCard(cardId, '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ', 'success');
                    logger.success('–ë–∞–∑–æ–≤–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
                    return true;
                } else {
                    throw new Error('–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                updateCard(cardId, `–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                logger.error(`–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º: ${error.message}`);
                return false;
            }
        }

        // 2. DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è Supabase
        async function testSupabaseDNS() {
            const cardId = 'dns-—Ä–µ–∑–æ–ª—é—Ü–∏—è';
            logger.info('–ü—Ä–æ–≤–µ—Ä–∫–∞ DNS —Ä–µ–∑–æ–ª—é—Ü–∏–∏ Supabase...');

            try {
                const url = new URL(SUPABASE_CONFIG.url);
                const hostname = url.hostname;

                // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–æ–≤–æ–º—É –¥–æ–º–µ–Ω—É
                const response = await fetch(`https://${hostname}`, {
                    method: 'HEAD',
                    mode: 'no-cors',
                    timeout: 10000
                });

                updateCard(cardId, `DNS –¥–ª—è ${hostname} —Ä–∞–±–æ—Ç–∞–µ—Ç`, 'success');
                logger.success(`DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è –¥–ª—è ${hostname} —É—Å–ø–µ—à–Ω–∞`);
                return true;
            } catch (error) {
                updateCard(cardId, `DNS –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                logger.error(`DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å: ${error.message}`);
                return false;
            }
        }

        // 3. CORS –ø–æ–ª–∏—Ç–∏–∫–∏
        async function testCORSPolicies() {
            const cardId = 'cors-–ø–æ–ª–∏—Ç–∏–∫–∏';
            logger.info('–ü—Ä–æ–≤–µ—Ä–∫–∞ CORS –ø–æ–ª–∏—Ç–∏–∫...');

            try {
                // –ü—Ä–æ—Å—Ç–æ–π OPTIONS –∑–∞–ø—Ä–æ—Å
                const response = await fetch(SUPABASE_CONFIG.url, {
                    method: 'OPTIONS',
                    headers: {
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'apikey, authorization'
                    }
                });

                updateCard(cardId, 'CORS –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã', 'success');
                logger.success('CORS –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã');
                return true;
            } catch (error) {
                updateCard(cardId, `CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã: ${error.message}`, 'warning');
                logger.warning(`CORS –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã: ${error.message}`);
                return false;
            }
        }

        // 4. Supabase API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
        async function testSupabaseAPI() {
            const cardId = 'supabase-api';
            logger.info('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Supabase API...');

            try {
                // –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π fetch –±–µ–∑ SDK
                const response = await fetch(`${SUPABASE_CONFIG.url}/rest/v1/`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_CONFIG.key,
                        'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    updateCard(cardId, 'Supabase API –æ—Ç–≤–µ—á–∞–µ—Ç', 'success');
                    logger.success('Supabase API –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                updateCard(cardId, `API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
                logger.error(`Supabase API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`);
                return false;
            }
        }

        // 5. –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
        async function testProfilesTable() {
            const cardId = '—Ç–∞–±–ª–∏—Ü–∞-profiles';
            logger.info('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ profiles...');

            try {
                const response = await fetch(`${SUPABASE_CONFIG.url}/rest/v1/profiles?select=count&limit=1`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_CONFIG.key,
                        'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });

                if (response.ok || response.status === 406) { // 406 –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –¥–ª—è –ø—É—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã
                    updateCard(cardId, '–¢–∞–±–ª–∏—Ü–∞ profiles –¥–æ—Å—Ç—É–ø–Ω–∞', 'success');
                    logger.success('–¢–∞–±–ª–∏—Ü–∞ profiles –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤');
                    return true;
                } else {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
            } catch (error) {
                updateCard(cardId, `–¢–∞–±–ª–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: ${error.message}`, 'error');
                logger.error(`–¢–∞–±–ª–∏—Ü–∞ profiles –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: ${error.message}`);
                return false;
            }
        }

        // 6. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π Supabase –∫–ª–∏–µ–Ω—Ç
        async function testAlternativeSupabaseClient() {
            const cardId = '–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π-–∫–ª–∏–µ–Ω—Ç';
            logger.info('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ Supabase –∫–ª–∏–µ–Ω—Ç–∞...');

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º Supabase SDK –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                if (!window.supabase) {
                    await loadSupabaseSDK();
                }

                // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
                const client = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key, {
                    db: {
                        schema: 'public',
                    },
                    auth: {
                        autoRefreshToken: false,
                        persistSession: false
                    },
                    global: {
                        headers: {
                            'X-Client-Info': 'diagnostic-client'
                        }
                    }
                });

                // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
                const { data, error, status, statusText } = await client
                    .from('profiles')
                    .select('count')
                    .limit(1);

                if (!error || error.code === 'PGRST116') { // PGRST116 = –ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞
                    updateCard(cardId, '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    logger.success('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π Supabase –∫–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è');
                    return { success: true, client };
                } else {
                    throw error;
                }
            } catch (error) {
                updateCard(cardId, `–ö–ª–∏–µ–Ω—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
                logger.error(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`);
                return { success: false, client: null };
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ Supabase SDK
        async function loadSupabaseSDK() {
            return new Promise((resolve, reject) => {
                if (window.supabase) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        async function runNetworkDiagnostic() {
            const grid = document.getElementById('diagnosticGrid');
            grid.innerHTML = '';

            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
            const tests = [
                { title: '–°–µ—Ç–µ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å', icon: 'üåê', test: testNetworkConnectivity },
                { title: 'DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è', icon: 'üîç', test: testSupabaseDNS },
                { title: 'CORS –ø–æ–ª–∏—Ç–∏–∫–∏', icon: 'üîê', test: testCORSPolicies },
                { title: 'Supabase API', icon: '‚òÅÔ∏è', test: testSupabaseAPI },
                { title: '–¢–∞–±–ª–∏—Ü–∞ profiles', icon: 'üóÑÔ∏è', test: testProfilesTable },
                { title: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç', icon: 'üîÑ', test: testAlternativeSupabaseClient }
            ];

            tests.forEach(test => {
                grid.appendChild(createDiagnosticCard(test.title, test.icon));
            });

            updateProgress(0);
            const results = [];

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                logger.info(`–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞: ${test.title}`);
                
                try {
                    const result = await test.test();
                    results.push({ name: test.title, result, success: result === true || result?.success === true });
                } catch (error) {
                    logger.error(`–¢–µ—Å—Ç ${test.title} –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π: ${error.message}`);
                    results.push({ name: test.title, result: false, success: false });
                }

                updateProgress(((i + 1) / tests.length) * 100);
                await new Promise(resolve => setTimeout(resolve, 500)); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
            }

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–µ—à–µ–Ω–∏—è
            analyzeDiagnosticResults(results);
        }

        // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π
        function analyzeDiagnosticResults(results) {
            const successCount = results.filter(r => r.success).length;
            const solutionSection = document.getElementById('solutionSection');
            const solutionContent = document.getElementById('solutionContent');

            logger.info(`–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${successCount}/${results.length} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ`);

            let solutions = [];

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
            results.forEach(result => {
                if (!result.success) {
                    switch (result.name) {
                        case '–°–µ—Ç–µ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å':
                            solutions.push({
                                title: 'üåê –ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º',
                                description: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞.',
                                actions: ['–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä', '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', '–û—Ç–∫–ª—é—á–∏—Ç–µ VPN –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è']
                            });
                            break;
                        case 'DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è':
                            solutions.push({
                                title: 'üîç –ü—Ä–æ–±–ª–µ–º–∞ —Å DNS',
                                description: 'DNS –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∞–¥—Ä–µ—Å Supabase —Å–µ—Ä–≤–µ—Ä–∞.',
                                actions: ['–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π DNS (8.8.8.8)', '–û—á–∏—Å—Ç–∏—Ç–µ DNS –∫—ç—à', '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞']
                            });
                            break;
                        case 'CORS –ø–æ–ª–∏—Ç–∏–∫–∏':
                            solutions.push({
                                title: 'üîê CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è',
                                description: '–ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏–∑-–∑–∞ CORS –ø–æ–ª–∏—Ç–∏–∫.',
                                actions: ['–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ Supabase', '–î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ allowed origins', '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS']
                            });
                            break;
                        case 'Supabase API':
                            solutions.push({
                                title: '‚òÅÔ∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω',
                                description: 'Supabase API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã.',
                                actions: ['–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ Supabase', '–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ URL', '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á']
                            });
                            break;
                        case '–¢–∞–±–ª–∏—Ü–∞ profiles':
                            solutions.push({
                                title: 'üóÑÔ∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π',
                                description: '–¢–∞–±–ª–∏—Ü–∞ profiles –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.',
                                actions: ['–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É profiles –≤ Supabase', '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞', '–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã']
                            });
                            break;
                    }
                }
            });

            // –û–±—â–∏–µ —Ä–µ—à–µ–Ω–∏—è
            if (successCount < results.length / 2) {
                solutions.push({
                    title: '‚öôÔ∏è –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏',
                    description: '–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–±—É—é—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.',
                    actions: [
                        '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase –ø—Ä–æ–µ–∫—Ç–∞',
                        '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Supabase',
                        '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è'
                    ]
                });
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ—à–µ–Ω–∏—è
            if (solutions.length > 0) {
                solutionContent.innerHTML = solutions.map(solution => `
                    <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                        <h3 style="margin-bottom: 10px; color: #51cf66;">${solution.title}</h3>
                        <p style="margin-bottom: 10px; opacity: 0.9;">${solution.description}</p>
                        <ul style="list-style: none; padding: 0;">
                            ${solution.actions.map(action => `<li style="padding: 5px 0; padding-left: 20px; position: relative;">
                                <span style="position: absolute; left: 0;">‚Ä¢</span> ${action}
                            </li>`).join('')}
                        </ul>
                    </div>
                `).join('');
                solutionSection.style.display = 'block';
            }
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        async function tryAlternativeConnection() {
            logger.info('–ü–æ–ø—ã—Ç–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
            
            const grid = document.getElementById('diagnosticGrid');
            grid.innerHTML = '';
            grid.appendChild(createDiagnosticCard('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', 'üîÑ'));

            try {
                // –ú–µ—Ç–æ–¥ 1: –ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
                updateCard('–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤...', 'pending');
                
                const response = await fetch(`${SUPABASE_CONFIG.url}/rest/v1/profiles?select=*&limit=1`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_CONFIG.key,
                        'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok || response.status === 406) {
                    updateCard('–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', '–ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç!', 'success');
                    logger.success('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP —É—Å–ø–µ—à–Ω–æ');

                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –∫–ª–∏–µ–Ω—Ç
                    window.SimpleSupabaseClient = {
                        async select(table, columns = '*', limit = null) {
                            let url = `${SUPABASE_CONFIG.url}/rest/v1/${table}?select=${columns}`;
                            if (limit) url += `&limit=${limit}`;

                            const response = await fetch(url, {
                                headers: {
                                    'apikey': SUPABASE_CONFIG.key,
                                    'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
                                    'Content-Type': 'application/json'
                                }
                            });

                            return await response.json();
                        },

                        async insert(table, data) {
                            const response = await fetch(`${SUPABASE_CONFIG.url}/rest/v1/${table}`, {
                                method: 'POST',
                                headers: {
                                    'apikey': SUPABASE_CONFIG.key,
                                    'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
                                    'Content-Type': 'application/json',
                                    'Prefer': 'return=representation'
                                },
                                body: JSON.stringify(data)
                            });

                            return await response.json();
                        }
                    };

                    logger.success('–°–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–æ–π HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Supabase');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                updateCard('–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', `–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                logger.error(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: ${error.message}`);
                return false;
            }
        }

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function fixConfiguration() {
            logger.info('–ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
            
            const grid = document.getElementById('diagnosticGrid');
            grid.innerHTML = '';
            
            const fixCard = createDiagnosticCard('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', '‚öôÔ∏è');
            grid.appendChild(fixCard);

            try {
                updateCard('–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫...', 'pending');

                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º URL —Ñ–æ—Ä–º–∞—Ç
                const urlCheck = SUPABASE_CONFIG.url.match(/^https:\/\/[a-z0-9]+\.supabase\.co$/);
                if (!urlCheck) {
                    throw new Error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL Supabase');
                }

                // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞
                if (SUPABASE_CONFIG.key.length < 100) {
                    throw new Error('API –∫–ª—é—á —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π');
                }

                // 3. –°–æ–∑–¥–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                const fixedConfig = {
                    ...SUPABASE_CONFIG,
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    options: {
                        db: { schema: 'public' },
                        auth: { 
                            autoRefreshToken: false,
                            persistSession: false,
                            detectSessionInUrl: false
                        },
                        global: {
                            headers: {
                                'X-Client-Info': 'tarot-app/1.0'
                            }
                        }
                    }
                };

                // 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                await loadSupabaseSDK();
                const testClient = window.supabase.createClient(
                    fixedConfig.url, 
                    fixedConfig.key, 
                    fixedConfig.options
                );

                const { data, error } = await testClient
                    .from('profiles')
                    .select('count')
                    .limit(1);

                if (!error || error.code === 'PGRST116') {
                    updateCard('–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    logger.success('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞');
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–±–æ—á–∏–π –∫–ª–∏–µ–Ω—Ç
                    window.FixedSupabaseClient = testClient;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                    displayFixedConfiguration(fixedConfig);
                    return true;
                } else {
                    throw error;
                }

            } catch (error) {
                updateCard('–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', `–ù–µ —É–¥–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å: ${error.message}`, 'error');
                logger.error(`–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å: ${error.message}`);
                return false;
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function displayFixedConfiguration(config) {
            const solutionSection = document.getElementById('solutionSection');
            const solutionContent = document.getElementById('solutionContent');

            solutionContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #51cf66; margin-bottom: 15px;">‚úÖ –†–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞!</h3>
                    <p style="margin-bottom: 15px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:</p>
                    
                    <div class="code-block">
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
const FIXED_SUPABASE_CONFIG = {
    url: '${config.url}',
    key: '${config.key.substring(0, 20)}...',
    options: ${JSON.stringify(config.options, null, 2)}
};

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
const supabaseClient = window.supabase.createClient(
    FIXED_SUPABASE_CONFIG.url,
    FIXED_SUPABASE_CONFIG.key,
    FIXED_SUPABASE_CONFIG.options
);

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
async function testConnection() {
    const { data, error } = await supabaseClient
        .from('profiles')
        .select('*')
        .limit(1);
    
    if (error && error.code !== 'PGRST116') {
        console.error('–û—à–∏–±–∫–∞:', error);
    } else {
        console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!', data);
    }
}
                    </div>
                </div>

                <div style="margin-bottom: 20px; padding: 15px; background: rgba(78, 205, 196, 0.1); border-radius: 10px; border-left: 4px solid #4ecdc4;">
                    <h4 style="color: #4ecdc4; margin-bottom: 10px;">üîß –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 5px 0; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: #4ecdc4;">‚Ä¢</span>
                            –û—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
                        </li>
                        <li style="padding: 5px 0; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: #4ecdc4;">‚Ä¢</span>
                            –û—Ç–∫–ª—é—á–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
                        </li>
                        <li style="padding: 5px 0; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: #4ecdc4;">‚Ä¢</span>
                            –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
                        </li>
                        <li style="padding: 5px 0; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: #4ecdc4;">‚Ä¢</span>
                            –£–∫–∞–∑–∞–Ω–∞ —è–≤–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                        </li>
                    </ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #51cf66; margin-bottom: 10px;">üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</h4>
                    <ol style="padding-left: 20px;">
                        <li style="margin-bottom: 8px;">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –≤—ã—à–µ –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</li>
                        <li style="margin-bottom: 8px;">–ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é</li>
                        <li style="margin-bottom: 8px;">–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ testConnection()</li>
                        <li style="margin-bottom: 8px;">–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç</li>
                    </ol>
                </div>
            `;

            solutionSection.style.display = 'block';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
            document.getElementById('startDiagnostic').addEventListener('click', async () => {
                logger.info('–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π —Å–µ—Ç–µ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
                await runNetworkDiagnostic();
            });

            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            document.getElementById('testAlternativeConnection').addEventListener('click', async () => {
                logger.info('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
                await tryAlternativeConnection();
            });

            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            document.getElementById('fixConfiguration').addEventListener('click', async () => {
                logger.info('–ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
                await fixConfiguration();
            });

            // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
            document.getElementById('clearLogs').addEventListener('click', () => {
                document.getElementById('logContainer').innerHTML = '';
                document.getElementById('diagnosticGrid').innerHTML = '';
                document.getElementById('solutionSection').style.display = 'none';
                updateProgress(0);
                logger.info('–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—á–∏—â–µ–Ω');
            });

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                logger.info('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
                runNetworkDiagnostic();
            }, 1000);
        });

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            logger.error(`–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ${event.error?.message || event.message}`);
        });

        window.addEventListener('unhandledrejection', (event) => {
            logger.error(`–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–∏—Å–∞: ${event.reason}`);
        });
    </script>
</body>
</html>
